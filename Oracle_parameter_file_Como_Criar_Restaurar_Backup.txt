========================================================================================
== Oracle Parameter File - Como Criar e Restaurar Backup
== Marcio Mandarino
== 07 de agosto de 2025
== marcio@mrdba.com.br
== www.mrdba.com.br
== https://www.linkedin.com/in/marciomandarino/
========================================================================================


=================================================================
== ğŸ¯ Resumo do vÃ­deo:
=================================================================
ğŸ“ O que Ã© o SPFILE  
ğŸ“ Backup via RMAN  
ğŸ“ Backup via SQL*Plus  
ğŸ“ Backup via Sistema Operacional  
ğŸ“ Restaurando o SPFILE via PFILE
ğŸ“ RestauraÃ§Ã£o via RMAN  
ğŸ“ ConclusÃ£o


=================================================================
== ğŸ¯ VisÃ£o Geral
=================================================================
â–¶ï¸ O SPFILE (Server Parameter File) Ã© o arquivo binÃ¡rio que armazena parÃ¢metros de inicializaÃ§Ã£o do banco  
â–¶ï¸ Diferente do PFILE, ele Ã© lido diretamente pelo Oracle na inicializaÃ§Ã£o  
â–¶ï¸ Fazer backup do SPFILE Ã© essencial para restaurar a configuraÃ§Ã£o em caso de corrupÃ§Ã£o ou perda  
â–¶ï¸ Pode ser feito via RMAN, SQL*Plus ou diretamente no sistema operacional  
âš ï¸ Recomenda-se manter cÃ³pias do SPFILE junto aos backups regulares do banco
*

=================================================================
== ğŸ¯ Backup do SPFILE via RMAN
=================================================================
â–¶ï¸ MÃ©todo mais recomendado, pois integra o backup do SPFILE com o resto do ambiente  
â–¶ï¸ Pode ser feito com o banco aberto ou montado

RMAN> BACKUP SPFILE;

RMAN> BACKUP SPFILE FORMAT '/backup/spfile_%U.bkp';

ğŸ’¡ TambÃ©m Ã© possÃ­vel incluir o SPFILE junto com o backup do banco:
RMAN> BACKUP DATABASE INCLUDE CURRENT CONTROLFILE SPFILE;

=================================================================
== ğŸ¯ Autobackup
=================================================================
â–¶ï¸ O parÃ¢metro CONTROLFILE AUTOBACKUP faz backup automÃ¡tico do spfile e control file quando um backup Ã© executado
â–¶ï¸ O backup do spfile e control file Ã© feito ao final do processo de backup

RMAN> show all;
RMAN> CONFIGURE CONTROLFILE AUTOBACKUP ON; # default
RMAN> backup database plus archivelog;


=================================================================
== ğŸ¯ Backup do SPFILE via SQL*Plus
=================================================================
â–¶ï¸ MÃ©todo alternativo, gerando um PFILE a partir do SPFILE  
â–¶ï¸ Ãštil para criar um backup legÃ­vel do conteÃºdo

SQL> CREATE PFILE='/backup/initcdb1.ora' FROM SPFILE;

ğŸ’¡ Para restaurar:
SQL> CREATE SPFILE FROM PFILE='/u01/backup/initcdb1.ora';

=================================================================
== ğŸ¯ Backup do SPFILE via Sistema Operacional
=================================================================
â–¶ï¸ MÃ©todo simples, copiando diretamente o arquivo binÃ¡rio do SPFILE  
â–¶ï¸ Pode ser feito com o banco aberto ou fechado  
â–¶ï¸ O local do SPFILE pode ser verificado no banco:

SQL> SHOW PARAMETER spfile;

-- Exemplo de saÃ­da:
-- /u01/app/oracle/product/19/dbhome_1/dbs/spfilecdb1.ora

-- Realizando o backup via SO:
$ cp /u01/app/oracle/product/19c/db_1/dbs/spfilecdb1.ora /backup/spfilecdb1.ora.bkp

ğŸ’¡ Para restaurar, basta inverter a cÃ³pia:
$ cp /backup/spfilecdb1.ora.bkp /u01/app/oracle/product/19c/db_1/dbs/spfilecdb1.ora
*

=================================================================
== ğŸ¯ Restaurando o SPFILE via PFILE
=================================================================
-- Fazendo backup do spfile
SQL> create pfile='/tmp/init.ora.bkp' from spfile;

-- Provocando um problema
SQL> alter system set sga_max_size=40g scope=spfile;

-- Reiniciando o banco
SQL> shutdown immediate;
SQL> startup;

-- Restaurando o spfile a partir do backup 
SQL> startup pfile='/tmp/init.ora.bkp' ;
SQL> create spfile from pfile='/tmp/init.ora.bkp';
SQL> shutdown immediate;
SQL> startup;


=================================================================
== ğŸ¯ Restaurando o SPFILE via RMAN
=================================================================
â–¶ï¸ Caso o SPFILE esteja corrompido ou ausente, Ã© possÃ­vel restaurÃ¡-lo usando RMAN  
â–¶ï¸ O banco deve estar no modo NOMOUNT para restaurar o SPFILE


$ rm -rf /u01/app/oracle/product/19c/db_1/dbs/spfilecdb1.ora
$ sqlplus / as sysdba
SQL> shutdown immediate;
SQL> startup;
SQL> exit;


$ echo "db_name=cdb1" > /tmp/init.ora
$ rman target /
RMAN> startup nomount pfile='/tmp/init.ora';
-- Restaurando de um backup especÃ­fico:
RMAN> RESTORE SPFILE FROM '/backup/spfile_0540hqd5_5_1_1.bkp';

ğŸ’¡ ApÃ³s restaurar o SPFILE, reinicie o banco normalmente:
RMAN> SHUTDOWN IMMEDIATE;
RMAN> STARTUP;


=================================================================
== ğŸ’¡ Boas PrÃ¡ticas
=================================================================
ğŸ’¡ Sempre que fizer alteraÃ§Ãµes no spfile, faÃ§a um backup
ğŸ’¡ Mantenha na rotina de backup do RMAN, uma cÃ³pia do spfile


=================================================================
== ğŸ ConclusÃ£o
=================================================================
â–¶ï¸ O SPFILE Ã© crÃ­tico para a inicializaÃ§Ã£o do Oracle  
â–¶ï¸ Sempre mantenha cÃ³pias atualizadas  
â–¶ï¸ RMAN Ã© a forma mais prÃ¡tica e integrada para backup e restauraÃ§Ã£o  
â–¶ï¸ SQL*Plus permite cÃ³pia legÃ­vel para anÃ¡lise ou ajustes manuais  
â–¶ï¸ Via SO Ã© rÃ¡pido e Ãºtil para cÃ³pias emergenciais
