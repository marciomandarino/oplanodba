========================================================================================
== Backup de PDB com RMAN
== Marcio Mandarino
== 09 de setembro de 2025
== marcio@mrdba.com.br
== www.mrdba.com.br
== https://www.linkedin.com/in/marciomandarino/
========================================================================================

=================================================================
== 🎯 Resumo do vídeo:
=================================================================
📍 Sequência
📍 Visão Geral
📍 Backup FULL do PDB
📍 Backup INCREMENTAL do PDB
📍 Backup com paralelismo
📍 Backup com compressão
📍 Backup de dois PDBs simultaneamente
📍 Backup com TAG
📍 Verificando os backups
📍 Limpa tudo
📍 Conclusão


=================================================================
== 🎯 Sequência
=================================================================
🛠️ Backup de PDB com RMAN
⏳ Restaurando um arquivo de dados do PDB
⏳ Restaurando o PDB inteiro
⏳ Restaurando um PDB excluído


=================================================================
== 🎯 Visão Geral
=================================================================
▶️ Com o RMAN, é possível gerar backups de cada PDB individualmente
▶️ Este recurso permite flexibilidade para suas operações de backup
  ▫️ Fazer backups de PDBs específicos
  ▫️ Redução do tempo de backup
  ▫️ Gerenciamento de recursos
  ▫️ Flexibilidade e controle


=================================================================
== 🎯 Backup FULL do PDB
=================================================================
-- Backup FULL (não incremental) de um PDB específico
RMAN> BACKUP PLUGGABLE DATABASE pdb1;


=================================================================
== 🎯 Backup INCREMENTAL do PDB
=================================================================
-- Level 0: estabelece a base para backups level 1 subsequentes
RMAN> BACKUP INCREMENTAL LEVEL 0 PLUGGABLE DATABASE pdb1;

-- Level 1 DIFFERENTIAL: copia blocos alterados desde o último level 1 ou level 0
RMAN> BACKUP INCREMENTAL LEVEL 1 DIFFERENTIAL PLUGGABLE DATABASE pdb1;

-- Level 1 CUMULATIVE: copia blocos alterados desde o último level 0
RMAN> BACKUP INCREMENTAL LEVEL 1 CUMULATIVE PLUGGABLE DATABASE pdb1;


=================================================================
== 🎯 Backup com paralelismo
=================================================================
-- Paralelismo (alocando canais manualmente)
RMAN> RUN {
  ALLOCATE CHANNEL ch1 DEVICE TYPE DISK;
  ALLOCATE CHANNEL ch2 DEVICE TYPE DISK;
  BACKUP PLUGGABLE DATABASE pdb1;
  RELEASE CHANNEL ch1;
  RELEASE CHANNEL ch2;
}


=================================================================
== 🎯 Backup com compressão
=================================================================
RMAN> BACKUP AS COMPRESSED BACKUPSET PLUGGABLE DATABASE pdb1;


=================================================================
== 🎯 Backup de dois PDBs simultaneamente
=================================================================
RMAN> BACKUP PLUGGABLE DATABASE pdb1, pdb2;


=================================================================
== 🎯 Backup com TAG
=================================================================
RMAN> BACKUP PLUGGABLE DATABASE pdb1 TAG 'BKP_FULL_PDB1';


=================================================================
== 🎯 Verificando os backups
=================================================================
-- Listar backups do PDB
RMAN> LIST BACKUP OF PLUGGABLE DATABASE pdb1;

-- Listar backups por TAG (ex.: BKP_FULL_PDB1)
RMAN> LIST BACKUP TAG 'BKP_FULL_PDB1';


=================================================================
== 🧹 Limpa tudo
=================================================================
-- Remover backups do PDB
RMAN> DELETE NOPROMPT BACKUP OF PLUGGABLE DATABASE pdb1;

-- Remover backups por TAG
RMAN> DELETE NOPROMPT BACKUP TAG 'BKP_FULL_PDB1';

-- Remover backups obsoletos
RMAN> DELETE NOPROMPT OBSOLETE;


=================================================================
== 🏁 Conclusão
=================================================================
▶️ Saber executar backups de PDBs individualmente é muito útil
▶️ O mais importante é você entender em quais situações você pode aplicar esse recurso
💡 Pratique, repita e repita mais uma vez. Quando estiver cansado, descanse e pratique mais uma vez
